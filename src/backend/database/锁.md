---
title: 锁
order: 3

copyright: <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0协议</a>
---



## 锁

三种锁：全局锁、表级锁、行级锁

### 全局锁

全局锁主要应用于做**全库逻辑备份**

会影响业务正常进行，解决方法：如果数据库的引擎支持的事务支持**可重复读的隔离级别**，那么在备份数据库之前先开启事务，会先创建 Read View，然后整个事务执行期间都在用这个 Read View，而且由于 MVCC 的支持，备份期间业务依然可以对数据进行更新操作。

### 表级锁

MySQL 里面表级别的锁有这几种：

- 表锁：`lock tables t_student read/write;`
  - 会限制本线程和其他线程的读写
- 元数据锁（MDL）：
  - 不需要显示使用，对数据库表进行操作时，会自动给这个表加上元数据锁，在事务提交后才会释放
  - 作用：当用户对表执行 CRUD 操作时，防止其他线程对这个表结构做变更
  - 对一张表进行 CRUD 操作时，加 **MDL 读锁**；
  - 对一张表做结构变更操作的时候，加 **MDL 写锁**；
- 意向锁：用于快速判断表里是否有记录被加锁（不理解）
  - 意向锁之间相互兼容，和读写锁之间只有IS锁和S锁兼容？？
- AUTO-INC 锁：表级别锁，在插入数据时加锁，执行完插入语句后立即释放；
  - 作用：阻塞其他插入语句，保证插入数据时，被 `AUTO_INCREMENT` 修饰的字段的值是连续递增的。
  - 三种实现（TODO）