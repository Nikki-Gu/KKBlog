---
title: 设备管理
order: 4

copyright: <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0协议</a>
---

## 设备管理

[图解系统-设备管理](https://xiaolincoding.com/os/7_device/device.html#%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F)

### 设备控制器和驱动

每个设备对应有：

- 硬件：设备控制器（有自己的芯片和寄存器：状态寄存器、命令寄存器、数据寄存器）
- 软件：设备驱动程序
  - 操作系统操作设备控制器的桥梁/接口
  - 不同设备驱动程序提供统一的接口给操作系统
  - 包含中断处理函数来处理中断，中断处理函数是在驱动初始化的时候注册的

### I/O设备分类

- 块设备：数据存储在固定大小的块中，每个块有地址 ，比如硬盘、USB
  - 数据缓冲区
- 字符设备：不可寻址，比如鼠标、键盘
  - 没有数据缓冲区，数据存在寄存器

### I/O控制方式

- 轮询等待
- 中断：
  - 软中断：INT指令
  - 中断控制器（硬件支持）：数据准备好后触发中断到中断控制器，中断控制器通知CPU进行中断
- DMA（Direct Memory Access）控制器（硬件支持）
  - CPU和DMA交互，DMA和设备交互，设备直接将数据放入内存

### 通用块层

文件系统和块设备之间的一个抽象层，作用：

- 给应用程序提供访问块设备的接口
- 进行I/O调度

### 键盘敲入字符发生了什么

1. 键盘控制器将字符数据存储在寄存器中
2. 中断控制器给CPU发送中断请求
3. 保存被中断进程的CPU上下文，调用键盘驱动程序在初始化时注册的中断处理函数进行处理
4. 处理完成，恢复被中断进程的CPU上下文
